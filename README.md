# Bash Script для настройки сервера

Этот Bash-скрипт предназначен для быстрой настройки сервера на базе Ubuntu или Debian. Он позволяет:

- Обновить систему
- Установить необходимые утилиты
- Создать нового пользователя с правами `sudo`
- Изменить порт SSH для повышения безопасности
- Настроить файрвол (UFW)
- Запретить доступ для пользователя `root` по SSH
- Установить защиту от брутфорс-атак с помощью Fail2Ban
- Установить и настроить `rsyslog` для ведения логов (если они отсутствуют)

## Требования

Для запуска скрипта потребуется:

- Доступ к серверу с правами `root`
- Операционная система: Ubuntu или Debian (другие дистрибутивы могут не поддерживаться)

## Установка и запуск

Чтобы запустить скрипт, используйте одну из следующих команд:

1. Для запуска скрипта с правами `root`:

    ```bash
    bash <(curl -Ls https://raw.githubusercontent.com/KostenkoV-V/VPS-setup/main/setup_server.sh)
    ```

2. Если вам нужно явно указать `sudo`:

    ```bash
    sudo bash <(curl -Ls https://raw.githubusercontent.com/KostenkoV-V/VPS-setup/main/setup_server.sh)
    ```

## Основные этапы работы скрипта

### 1. Обновление системы

Скрипт обновит список пакетов и установит последние обновления:

```bash
apt-get update -y
apt-get upgrade -y
```

### 2. Установка необходимых утилит

Устанавливаются следующие утилиты:

- **`sudo`**: Утилита для управления правами доступа. С помощью `sudo` можно выполнять команды с правами администратора (root) без необходимости входа в систему как root.
- **`ufw`** (Uncomplicated Firewall): Легкий интерфейс для настройки файрвола (межсетевого экрана) в Linux. Он помогает ограничить доступ к серверу, разрешая или запрещая подключение по определенным портам.
- **`fail2ban`**: Утилита для защиты от брутфорс-атак. Она отслеживает неудачные попытки входа в систему и блокирует IP-адреса, с которых происходят попытки атак.
- **`rsyslog`**: Система ведения логов для получения и обработки системных журналов. Устанавливается, если на сервере не найдены файлы логов, такие как `auth.log`, которые важны для мониторинга безопасности.

### 3. Проверка наличия логов

Скрипт проверяет, существует ли файл логов `auth.log` в директории `/var/log`. Этот файл необходим для отслеживания попыток входа и других действий, связанных с безопасностью.

- Если логи отсутствуют, скрипт установит и настроит сервис `rsyslog`, который будет вести журналы системы.
- В случае наличия логов скрипт продолжит выполнение без изменений.

### 4. Создание нового пользователя

Скрипт предложит создать нового пользователя для входа в систему вместо пользователя `root`. Это повышает безопасность, так как использование `root` для входа в систему не рекомендуется.

- **Валидация имени пользователя**: Имя пользователя должно состоять только из латинских букв, цифр и подчеркиваний. Нельзя использовать пробелы и специальные символы.
- **Запрос пароля**: Для нового пользователя нужно будет ввести и подтвердить пароль. Пароль не должен быть пустым, а также должен совпадать при повторном вводе.
- **Добавление в группу `sudo`**: Новый пользователь будет добавлен в группу `sudo`, что даст возможность выполнять административные задачи.

### 5. Настройка порта SSH

Для повышения безопасности сервера рекомендуется изменить стандартный порт SSH (22) на нестандартный, чтобы усложнить задачу потенциальным злоумышленникам.

- Скрипт запросит новый порт SSH и убедится, что выбранный порт находится в пределах безопасного диапазона (от 1024 до 65535).
- Порт будет изменен в конфигурационном файле SSH, и сервис SSH будет перезапущен для применения изменений.

### 6. Настройка файрвола (UFW)

Скрипт настроит файрвол (UFW), который будет контролировать доступ к серверу:

- **Разрешение SSH-порта**: Порт SSH, который был настроен ранее, будет разрешен для входящих соединений.
- **Разрешение HTTP и HTTPS**: Стандартные порты 80 и 443 для веб-сервера будут открыты.
- **Запрет входящих соединений по умолчанию**: Все другие входящие соединения будут заблокированы.
- **Разрешение исходящего трафика**: Исходящие соединения будут разрешены по умолчанию.

После настройки фаервола он будет активирован с помощью команды `ufw --force enable`.

### 7. Запрет доступа для root по SSH

Для повышения безопасности скрипт предложит запретить доступ по SSH для пользователя `root`.

- Если вы выберете этот вариант, скрипт изменит конфигурацию SSH и установит параметр `PermitRootLogin no`, что заблокирует доступ для `root` через SSH.

### 8. Установка Fail2Ban

Fail2Ban — это утилита, которая защищает сервер от атак типа "грубой силы". Она отслеживает неудачные попытки входа и блокирует IP-адреса, с которых происходят такие попытки.

- Скрипт запросит у вас параметры для настройки Fail2Ban:
  - **Количество неудачных попыток входа, после которых блокируется IP-адрес.**
  - **Время блокировки IP-адреса (в секундах).**
  - **Временной интервал для подсчета попыток входа (в секундах).**
- Эти параметры будут настроены в конфигурационном файле Fail2Ban для защиты SSH-соединений.

После этого Fail2Ban будет перезапущен и активирован.



